
これは **「Web上でピッキングができる管理者用・テスト用UI」** の要件定義（設計書レベル）になります。

Smart WMS の運用フローと整合させるため、
このWeb UIは「Androidアプリの代替」「ピッキング進行の管理」「ピッカー代行（テスト・管理者操作）」という3役を担う設計が最適です。

---

# 🖥️ WebピッキングUI 仕様書（管理者・テスト用）

---

## 🎯 目的

本UIは、倉庫現場で使用しているAndroidピッキングアプリと同様の機能を、
**管理者・テスト担当者がWebブラウザ上で利用できるようにする**ことを目的とする。

### 対象ユーザー

| 区分       | 権限   | 主な目的                 |
| -------- | ---- | -------------------- |
| 倉庫管理者    | 管理権限 | 担当者の割当／進捗強制更新        |
| システム管理者  | 全権限  | デバッグ・テストピッキング        |
| ピッカー（代行） | 一般   | 自身の割り当てピッキングをブラウザで実施 |

---

## 🧩 構成概要

| 画面                     | 主目的            |
| ---------------------- | -------------- |
| ① ピッキング作業リスト（担当者未割当一覧） | 未担当の作業を一覧化     |
| ② ピッキング担当者割当画面         | タスクへピッカーを割り当て  |
| ③ ピッキング実施画面（商品別／伝票別）   | 割り当て済みピッキングを実施 |

---

## 1️⃣ 画面①：担当者未割り当てピッキング作業リスト

### 概要

波動ごとに生成されたピッキングタスクのうち、
まだ `picker_id IS NULL` の作業を一覧で表示する。

### 機能仕様

| 要素    | 内容                                                                          |
| ----- | --------------------------------------------------------------------------- |
| 表示条件  | `wms_picking_tasks.status IN ('PENDING','PICKING')` AND `picker_id IS NULL` |
| 主なカラム | 波動番号 / 倉庫 / コース / 伝票番号 / 明細数 / ステータス / 作成日時                                 |
| 並び順   | 倉庫 → コース → 波動ID → 作成日時昇順                                                    |
| フィルタ  | 倉庫 / 配送コース / ステータス                                                          |
| アクション | 「担当者を割り当てる」ボタン → ②画面へ遷移                                                     |

#### UIワイヤーフレーム（概略）

```
┌───────────────────────────────┐
│  🔍 フィルタ：倉庫 [▼]  コース [▼]  ステータス [▼]            │
├───────────────────────────────┤
│ [波動No]  [倉庫]  [コース]  [伝票]  [商品数]  [状態]  [担当者]  [操作] │
│ W003-C015-20251022-1007  倉庫A  午前便  E0012  25  PENDING  未割当  [割当] │
│ W003-C015-20251022-1008  倉庫A  午前便  E0013  12  PENDING  未割当  [割当] │
└───────────────────────────────┘
```

---

## 2️⃣ 画面②：ピッキング作業への担当者割り当て

### 概要

管理者が、未割当タスクに対してピッカー（担当者）を割り当てる。

### 機能仕様

行別にチェックボックスをつけ、チェックしたものに対するピッカー割り当てを実施。
その際にモーダルでピッカーを選択し確定

#### UIワイヤーフレーム（概略）

``
---

## 3️⃣ 画面③：ピッキング実施（管理者・ピッカー兼用）

### 概要

選択したタスク（伝票単位）のピッキングをWebブラウザ上で行う。
Androidピッキングアプリと同様の動線で、**ゾーン順／通路順／商品順** に商品を表示。
管理者は欠品・完了を手動操作できる。

---

### 機能仕様

| 要素    | 内容                                                                                |
| ----- | --------------------------------------------------------------------------------- |
| 表示データ | `wms_picking_item_results`（タスクIDごと）                                               |
| 並び順   | wms_picking_area_id → walking_order → item_id                                     |
| 作業モード | ピッカー表示モード／管理者強制モード（すべて編集可）                                                        |
| 操作    | 数量入力・欠品登録・完了報告                                                                    |
| 更新先   | `wms_picking_item_results.picked_qty`, `shortage_qty`, `status`                   |
| 完了条件  | すべての商品が `COMPLETED` or `SHORTAGE`                                                 |
| 出荷連携  | 完了後に `wms_picking_tasks.status='COMPLETED'`／`earnings.picking_status='COMPLETED'` |

**注:** `zone_code` は廃止され、`wms_picking_areas` テーブルで管理されるようになりました。ピッキングエリア（常温/冷蔵/冷凍/ポークリプト）ごとにタスクが分割されます。

---

### 表示構成

```
┌──────────────────────────────────────────────┐
│ ピッキング作業画面：伝票 E0012（倉庫A・波動1007）          │
├──────────────────────────────────────────────┤
│ エリア：常温エリア  ｜ 担当：田中                         │
│--------------------------------------------------------------│
│ [ロケーション]  [商品名]         [予定数] [ピック数] [欠品] │
│ A-1-1          アサヒスーパードライ  10       [10]     [0]  │
│ A-1-2          キリン一番搾り        8        [7]      [1]  │
│--------------------------------------------------------------│
│ ☐ 完了チェック       ☐ 欠品チェック   [登録] [完了報告]      │
└──────────────────────────────────────────────┘
```

---

## 4️⃣ 管理者強制ピッキング機能

### 利用目的

* テスト用（実在庫がなくてもピッキング済みにできる）
* ピッカー操作が遅延しているときに出荷を進めるための緊急措置

### 処理仕様

| アクション          | 動作内容                                               |
| -------------- | -------------------------------------------------- |
| 「強制ピッキング完了」ボタン | すべての `picked_qty = planned_qty` に自動更新              |
| 欠品ありの場合        | `shortage_qty` 自動計算、`status='SHORTAGE'` 付与         |
| 完了後            | `wms_picking_tasks.status='COMPLETED'` に変更、出荷確定対象へ |

---

## 5️⃣ ナビゲーション構成（Filament想定）

| メニュー       | URL                                      | 概要                    |
| ---------- | ---------------------------------------- |-----------------------|
| ピッキング作業リスト | `/wms/picking-tasks`                     | ①担当者未割当一覧 （フィルタにより制御） |
| 担当者割当      | `/wms/picking-tasks/assign/{id}`         | ②担当者割当                |
| ピッキング実施    | `/wms/picking-tasks/{id}/execute`        | ③ピッキング実施              |
| 強制完了（管理者）  | `/wms/picking-tasks/{id}/force-complete` | 管理者操作用                |

---

## 6️⃣ アクセス制御

| 役割          | 権限               |
| ----------- | ---------------- |
| **倉庫管理者**   | 担当者割当・強制完了・すべて閲覧 |
| **ピッカー**    | 自身のタスク閲覧・ピッキング入力 |
| **システム管理者** | すべて（デバッグ・テスト）    |

---

## ✅ 運用イメージ

1️⃣ 波動生成後、未割当タスクが一覧に表示される。
2️⃣ 管理者がピッカーを割り当てる（または自分に割り当て）。
3️⃣ ピッキング画面で商品をスキャン／数量入力。
4️⃣ 完了後、「ピッキング完了」でタスクが終了し、出荷確定処理が有効化。
5️⃣ 緊急時は「強制完了」ボタンで完了ステータスに移行可能。

---
